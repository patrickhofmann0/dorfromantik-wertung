<div class="kampagne-visualizer">
  <svg 
    [attr.viewBox]="viewBoxDimensions().x + ' ' + viewBoxDimensions().y + ' ' + viewBoxDimensions().width + ' ' + viewBoxDimensions().height" 
    class="kampagne-svg" 
    preserveAspectRatio="xMidYMid meet">
    <!-- Draw paths first (so they appear behind milestones) -->
    @for (pfad of pfade(); track pfad.vonA + '-' + pfad.nachB) {
      @let posA = getPosition(pfad.vonA);
      @let posB = getPosition(pfad.nachB);
      @if (posA && posB) {
        <g>
          <!-- Path line -->
          <line
            [attr.x1]="posA.x + 60"
            [attr.y1]="posA.y + 20"
            [attr.x2]="posB.x + 60"
            [attr.y2]="posB.y + 20"
            class="pfad-linie"
          />

          <!-- Progress points along the path -->
          @for (index of createArray(pfad.kosten); track index) {
            @let point = calculatePointOnLine(
              posA.x + 60,
              posA.y + 20,
              posB.x + 60,
              posB.y + 20,
              index,
              pfad.kosten
            );
            @let clickable = isProgressPointClickable(pfad, index);
            <circle
              [attr.cx]="point.x"
              [attr.cy]="point.y"
              r="8"
              [class.progress-point]="true"
              [class.progress-completed]="isCheckboxChecked(pfad, index)"
              [class.progress-incomplete]="!isCheckboxChecked(pfad, index)"
              [class.progress-clickable]="clickable"
              [class.progress-disabled]="!clickable"
              (click)="onProgressPointClick(pfad, index)"
            />
            <text
              [attr.x]="point.x"
              [attr.y]="point.y + 20"
              class="progress-label"
              text-anchor="middle"
            >
              {{ index + 1 }}
            </text>
          }
        </g>
      }
    }

    <!-- Draw milestones -->
    @for (position of meilensteinPositionen(); track position.meilenstein) {
      <g>
        <rect
          [attr.x]="position.x"
          [attr.y]="position.y"
          width="120"
          height="40"
          class="meilenstein-box"
        />
        <text
          [attr.x]="position.x + 60"
          [attr.y]="position.y + 25"
          class="meilenstein-text"
          text-anchor="middle"
        >
          {{ position.label }}
        </text>
      </g>
    }
  </svg>

  <!-- Summary information -->
  <div class="fortschritt-summary">
    <h3>Kampagnenfortschritt</h3>
    @for (pfad of pfade(); track pfad.vonA + '-' + pfad.nachB) {
      <div class="pfad-summary">
        <span class="pfad-name">
          {{ getMeilensteinLabel(pfad.vonA) }} â†’ {{ getMeilensteinLabel(pfad.nachB) }}:
        </span>
        <span class="pfad-fortschritt">{{ pfad.fortschritt }} / {{ pfad.kosten }}</span>
      </div>
    }
  </div>
</div>
